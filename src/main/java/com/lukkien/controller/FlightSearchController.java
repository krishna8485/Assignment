package com.lukkien.controller;
import com.lukkien.dto.AirportsDto;
import com.lukkien.dto.FlightResultsDto;
import com.lukkien.model.Airport;
import com.lukkien.service.FlightService;
import com.lukkien.service.impl.FlightServiceImpl;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.web.servlet.ModelAndView;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.concurrent.atomic.AtomicLong;

/*
 * This Java source file was generated by the Gradle 'init' task.
 */
@Controller
public class FlightSearchController {

    @Autowired
    FlightService flightServiceImpl;

    private static final Logger logger = LogManager.getLogger(FlightSearchController.class);


    private final AtomicLong counter = new AtomicLong();
    private static final String template = "Hello, %s!";

    //Website
    //Statics
    //Spring restful-- completed
    //Spring boot -- completed
    @RequestMapping(value ="/getResults" , method = RequestMethod.GET)
    public @ResponseBody
    List<FlightResultsDto> getResults(@RequestParam("departure")
                                                 Airport departure, @RequestParam("arrival")
            Airport arrival) {
        logger.info("info flight search executed");
        List<FlightResultsDto> flightsResults = flightServiceImpl.findFlights(departure, arrival);
        logger.info("flightResultsDTo "+ flightsResults.toString());
        return flightsResults;
    }

    @RequestMapping(value ="/getAirportNames" , method = {RequestMethod.GET, RequestMethod.POST})
    public @ResponseBody
    List<Airport> getAirportNames(@RequestParam(name="query", required=true) String queryString) {
        logger.info("info getAirportNames executed" +queryString);
        //String a[] = new String[]{"abc","klm","xyz","pqr"};
        Airport airport = new Airport("LHR", "HETHROW LONDON");

        List <Airport> airportNames = new ArrayList<>();
        airportNames.add(airport);
        //AirportsDto an = new AirportsDto();
        //an.setAirportNames(airportNames);
        return airportNames;
    }

    @RequestMapping("/welcome")
    public ModelAndView homePage() {
        return new ModelAndView("FlightSearch");
    }

}